# π’° ν¬μΈνΈ κ΄€λ¦¬ μ‹μ¤ν… (TDD μ‹¤μµ)

> **TDD κΈ°λ° ν¬μΈνΈ κ΄€λ¦¬ μ„λΉ„μ¤**  
> ν¬μΈνΈ μ¶©μ „Β·μ‚¬μ©Β·μ΅°ν κΈ°λ¥μ„ ν…μ¤νΈ μ£Όλ„ κ°λ° λ°©μ‹μΌλ΅ κµ¬ν„ν•κ³ ,  
> `ReentrantLock` κΈ°λ° μ‚¬μ©μ λ‹¨μ„ **λ™μ‹μ„± μ μ–΄**λ¥Ό μ μ©ν–μµλ‹λ‹¤.

![Java](https://img.shields.io/badge/Java-17-orange?logo=java)
![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.2.0-brightgreen?logo=springboot)
![JUnit5](https://img.shields.io/badge/Test-JUnit5-red?logo=junit5)
![Gradle](https://img.shields.io/badge/Build-Gradle-blue?logo=gradle)

---

## π’΅ κ°λ° κ°μ”
μ΄ ν”„λ΅μ νΈλ” `Test-Driven Development`μ μ‹¤λ¬΄ μ μ© λ° **λ™μ‹μ„± μ•μ „ν• ν¬μΈνΈ κ΄€λ¦¬**λ¥Ό λ©ν‘λ΅ κ°λ°λμ—μµλ‹λ‹¤.

ν…μ¤νΈλ¥Ό λ¨Όμ € μ‘μ„±ν•κ³ , κΈ°λ¥μ„ μ μ§„μ μΌλ΅ ν™•μ¥ν•λ©°  
λΉ„μ¦λ‹μ¤ μ •μ±… κ²€μ¦, μμ™Έ μ²λ¦¬, Lock κΈ°λ° λ™μ‹μ„± μ μ–΄κΉμ§€ λ‹¨κ³„μ μΌλ΅ μ™„μ„±ν–μµλ‹λ‹¤.

---

## π§© μ£Όμ” κΈ°λ¥

| κΈ°λ¥ | μ„¤λ… |
|------|------|
| **ν¬μΈνΈ μ΅°ν** | μ‚¬μ©μμ ν„μ¬ ν¬μΈνΈ μ”μ•΅ μ΅°ν |
| **ν¬μΈνΈ μ¶©μ „** | ν¬μΈνΈ μ¶©μ „ (μµμ† 100μ›, μµλ€ 50,000μ› / ν, μΌμΌ ν•λ„ 100,000μ›) |
| **ν¬μΈνΈ μ‚¬μ©** | ν¬μΈνΈ μ°¨κ° (μµμ† 100μ›, μµλ€ 50,000μ› / ν) |
| **ν¬μΈνΈ λ‚΄μ—­ μ΅°ν** | μ¶©μ „ λ° μ‚¬μ© μ΄λ ¥ ν™•μΈ |

---

## π§ TDD κ°λ° ν”„λ΅μ„Έμ¤

λ³Έ ν”„λ΅μ νΈλ” **Red β†’ Green β†’ Refactor**μ TDD μ‚¬μ΄ν΄λ΅ μ§„ν–‰λμ—μµλ‹λ‹¤.

1. **Red** β€“ μ‹¤ν¨ν•λ” ν…μ¤νΈ μ‘μ„±
   > μ: β€100μ› λ―Έλ§ μ¶©μ „ μ‹ μ‹¤ν¨ν•΄μ•Ό ν•λ‹¤β€
2. **Green** β€“ μµμ†ν•μ μ½”λ“λ΅ ν…μ¤νΈ ν†µκ³Ό
3. **Refactor** β€“ μ¤‘λ³µ μ κ±° λ° κµ¬μ΅° κ°μ„ 
---
## β™οΈ μμ™Έ μ²λ¦¬ μ •μ±…

λΉ„μ¦λ‹μ¤ μ •μ±… μ„λ° μ‹ λ…μ‹μ μΌλ΅ `IllegalArgumentException` λλ” `IllegalStateException`μ„ λ°μƒμ‹ν‚¤λ©°,  
`ApiControllerAdvice`μ—μ„ HTTP 400 μ‘λ‹µμΌλ΅ λ³€ν™ν•©λ‹λ‹¤.

| μ •μ±… μ„λ° μƒν™© | μμ™Έ νƒ€μ… | μƒνƒ μ½”λ“ | λ©”μ‹μ§€ μμ‹                              |
|----------------|------------|------------|-------------------------------------|
| μµμ† μ¶©μ „ κΈμ•΅ λ―Έλ§ | `IllegalArgumentException` | 400 | "μ¶©μ „ κΈμ•΅μ€ μµμ† 100μ› μ΄μƒμ΄μ–΄μ•Ό ν•©λ‹λ‹¤."         |
| μµλ€ μ¶©μ „ κΈμ•΅ μ΄κ³Ό | `IllegalArgumentException` | 400 | "1ν μµλ€ μ¶©μ „ κΈμ•΅μ€ 50,000μ›μ…λ‹λ‹¤." |
| μµμ† μ‚¬μ© κΈμ•΅ λ―Έλ§ | `IllegalArgumentException` | 400 | "μ‚¬μ© κΈμ•΅μ€ μµμ† 100μ› μ΄μƒμ΄μ–΄μ•Ό ν•©λ‹λ‹¤." |
| μµλ€ μ‚¬μ© κΈμ•΅ μ΄κ³Ό | `IllegalArgumentException` | 400 | "1ν μµλ€ μ‚¬μ© κΈμ•΅μ€ 50,000μ›μ…λ‹λ‹¤." |
| μΌμΌ μ¶©μ „ ν•λ„ μ΄κ³Ό | `IllegalStateException` | 400 | "μΌμΌ μ¶©μ „ ν•λ„(100,000μ›)μ„ μ΄κ³Όν–μµλ‹λ‹¤."       |
| μµλ€ μ”μ•΅ μ΄κ³Ό | `IllegalStateException` | 400 | "μµλ€ μ”μ•΅μ€ 100,000μ›μ„ μ΄κ³Όν•  μ μ—†μµλ‹λ‹¤."      |
| μ”μ•΅ λ¶€μ΅± | `IllegalStateException` | 400 | "ν¬μΈνΈ μ”μ•΅μ΄ λ¶€μ΅±ν•©λ‹λ‹¤. (ν„μ¬ μ”μ•΅: Xμ›, μ‚¬μ© μ‹λ„: Yμ›)" |

---

## π”’ λ™μ‹μ„± μ μ–΄ λ°©μ‹

### β… μ μ© λ°©μ‹: `ReentrantLock + ConcurrentHashMap`

- μ‚¬μ©μλ³„ `ReentrantLock`μ„ `ConcurrentHashMap`μ— μ €μ¥ν•μ—¬ κ΄€λ¦¬
- λ™μΌ μ‚¬μ©μ μ”μ²­μ€ μ§λ ¬ν™”, μ„λ΅ λ‹¤λ¥Έ μ‚¬μ©μλ” λ³‘λ ¬ μ²λ¦¬ κ°€λ¥
- `finally` λΈ”λ΅μ—μ„ Lockμ„ ν•΄μ ν•μ—¬ μμ™Έ λ°μƒ μ‹μ—λ„ μ•μ „ν•κ² μ²λ¦¬

### π’΅ νΉμ§•
- **μ‚¬μ©μλ³„ Lock λ¶„λ¦¬** β†’ κ°™μ€ μ μ €μ μ”μ²­λ§ μμ°¨μ μΌλ΅ μ²λ¦¬
- **λ³‘λ ¬ μ²λ¦¬ κ°€λ¥** β†’ λ‹¤λ¥Έ μ μ € κ°„ μ”μ²­μ€ λ™μ‹μ— μ²λ¦¬ κ°€λ¥
- **μ•μ „ν• ν•΄μ  λ³΄μ¥** β†’ μμ™Έ λ°μƒ μ‹μ—λ„ Lockμ€ λ°λ“μ‹ ν•΄μ λ¨

### β οΈ λ‹¨μ  λ° κ°μ„  λ°©μ•

| ν•­λ© | λ¬Έμ μ  | κ°μ„  λ°©μ• |
|------|--------|-----------|
| **λ¶„μ‚° ν™κ²½ λ―Έμ§€μ›** | JVM λ‹¨μ„ Lockμ΄λΌ μ„λ²„ ν™•μ¥ μ‹ λ™κΈ°ν™” λ¶κ°€ | Redis λ¶„μ‚° Lock λλ” DB LockμΌλ΅ ν™•μ¥ |
| **λ©”λ¨λ¦¬ λ„μ κ°€λ¥μ„±** | Lock κ°μ²΄κ°€ Mapμ— κ³„μ† μ“μ„ | WeakHashMap μ‚¬μ© λλ” TTL κΈ°λ° μ •λ¦¬ |
| **λ°λ“λ½ μ„ν—** | μ—¬λ¬ Lockμ„ λ™μ‹μ— νλ“ν•  κ²½μ° | Lock μμ„ μΌκ΄€μ„± μ μ§€λ΅ μλ°© |

---

## π§Ύ ν…μ¤νΈ κ²€μ¦ ν•­λ©

| ν…μ¤νΈ μ‹λ‚λ¦¬μ¤ | κ²€μ¦ λ‚΄μ© |
|-----------------|-----------|
| λ‹¨μΌ μ‚¬μ©μ λ™μ‹ μ¶©μ „ | μ—¬λ¬ μ¤λ λ“κ°€ λ™μ‹μ— μ¶©μ „ν•΄λ„ μµμΆ… μ”μ•΅μ΄ μ •ν™•ν•¨ |
| μ—¬λ¬ μ‚¬μ©μ λ³‘λ ¬ μ¶©μ „ | μ„λ΅ λ‹¤λ¥Έ μ‚¬μ©μ μ”μ²­μ΄ λ³‘λ ¬λ΅ μ²λ¦¬λ¨ |
| μ¶©μ „ + μ‚¬μ© λ™μ‹ μ”μ²­ | μ¶©μ „κ³Ό μ‚¬μ©μ΄ λ™μ‹μ— λ°μƒν•΄λ„ ν¬μΈνΈ μ •ν•©μ„± μ μ§€ |
| μΌμΌ ν•λ„ κ²€μ¦ | λ‹¤μ¤‘ μ”μ²­ μƒν™©μ—μ„λ„ μΌμΌ ν•λ„κ°€ μ •ν™•ν μ μ©λ¨ |

---
## π§° κΈ°μ  μ¤νƒ

| κµ¬λ¶„ | κΈ°μ  |
|------|------|
| **Language** | Java 17 |
| **Framework** | Spring Boot 3.2.0 |
| **Build Tool** | Gradle |
| **Test** | JUnit 5, Mockito, MockMvc |
| **Concurrency** | ReentrantLock, ConcurrentHashMap |
---
## π“΅ API λ…μ„Έ

| λ©”μ„λ“ | μ—”λ“ν¬μΈνΈ | μ„¤λ… |
|--------|-------------|------|
| `GET` | `/point/{id}` | νΉμ • μ‚¬μ©μμ ν¬μΈνΈλ¥Ό μ΅°νν•©λ‹λ‹¤. |
| `PATCH` | `/point/{id}/charge` | μ‚¬μ©μμ ν¬μΈνΈλ¥Ό μ¶©μ „ν•©λ‹λ‹¤. |
| `PATCH` | `/point/{id}/use` | μ‚¬μ©μμ ν¬μΈνΈλ¥Ό μ‚¬μ©ν•©λ‹λ‹¤. |
| `GET` | `/point/{id}/histories` | μ‚¬μ©μμ ν¬μΈνΈ μ¶©μ „/μ‚¬μ© λ‚΄μ—­μ„ μ΅°νν•©λ‹λ‹¤. |
